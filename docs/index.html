<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Benjamin">
<meta name="dcterms.date" content="2024-12-26">
<meta name="description" content="2024-12-26 이해원회장님의 퀴즈에 대한 답">

<title>Quiz_Answer – R443-Survival_Quiz</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-ddd961a2510921635943dfbbd19534c4.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">R443-Survival_Quiz</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#quiz-데이터-주무르기-생존분석" id="toc-quiz-데이터-주무르기-생존분석" class="nav-link active" data-scroll-target="#quiz-데이터-주무르기-생존분석"><span class="header-section-number">1</span> Quiz 데이터 주무르기 + 생존분석</a>
  <ul class="collapse">
  <li><a href="#dataframe-index" id="toc-dataframe-index" class="nav-link" data-scroll-target="#dataframe-index"><span class="header-section-number">1.1</span> Dataframe Index</a>
  <ul class="collapse">
  <li><a href="#dataframe-load" id="toc-dataframe-load" class="nav-link" data-scroll-target="#dataframe-load"><span class="header-section-number">1.1.1</span> dataframe load</a></li>
  <li><a href="#개인정보제거" id="toc-개인정보제거" class="nav-link" data-scroll-target="#개인정보제거"><span class="header-section-number">1.1.2</span> 개인정보제거</a></li>
  <li><a href="#개인정보제거-답안" id="toc-개인정보제거-답안" class="nav-link" data-scroll-target="#개인정보제거-답안"><span class="header-section-number">1.1.3</span> 개인정보제거 답안</a></li>
  <li><a href="#개인정보제거2" id="toc-개인정보제거2" class="nav-link" data-scroll-target="#개인정보제거2"><span class="header-section-number">1.1.4</span> 개인정보제거2</a></li>
  <li><a href="#개인정보제거2-답안" id="toc-개인정보제거2-답안" class="nav-link" data-scroll-target="#개인정보제거2-답안"><span class="header-section-number">1.1.5</span> 개인정보제거2 답안</a></li>
  <li><a href="#특정컬럼제거" id="toc-특정컬럼제거" class="nav-link" data-scroll-target="#특정컬럼제거"><span class="header-section-number">1.1.6</span> 특정컬럼제거</a></li>
  <li><a href="#특정컬럼제거-답안" id="toc-특정컬럼제거-답안" class="nav-link" data-scroll-target="#특정컬럼제거-답안"><span class="header-section-number">1.1.7</span> 특정컬럼제거 답안</a></li>
  </ul></li>
  <li><a href="#생존분석" id="toc-생존분석" class="nav-link" data-scroll-target="#생존분석"><span class="header-section-number">1.2</span> 생존분석</a>
  <ul class="collapse">
  <li><a href="#데이터-준비" id="toc-데이터-준비" class="nav-link" data-scroll-target="#데이터-준비"><span class="header-section-number">1.2.1</span> 데이터 준비</a></li>
  <li><a href="#psm모델-준비" id="toc-psm모델-준비" class="nav-link" data-scroll-target="#psm모델-준비"><span class="header-section-number">1.2.2</span> psm모델 준비</a></li>
  <li><a href="#surv-객체-만들기" id="toc-surv-객체-만들기" class="nav-link" data-scroll-target="#surv-객체-만들기"><span class="header-section-number">1.2.3</span> Surv 객체 만들기</a></li>
  <li><a href="#rtd.s-생존곡선-답안" id="toc-rtd.s-생존곡선-답안" class="nav-link" data-scroll-target="#rtd.s-생존곡선-답안"><span class="header-section-number">1.2.4</span> rtd.S 생존곡선 답안</a></li>
  <li><a href="#psm-fit-모델-만들기" id="toc-psm-fit-모델-만들기" class="nav-link" data-scroll-target="#psm-fit-모델-만들기"><span class="header-section-number">1.2.5</span> psm fit 모델 만들기</a></li>
  <li><a href="#연속변수들-변형" id="toc-연속변수들-변형" class="nav-link" data-scroll-target="#연속변수들-변형"><span class="header-section-number">1.2.6</span> 연속변수들 변형</a></li>
  <li><a href="#연속변수들-변형---답" id="toc-연속변수들-변형---답" class="nav-link" data-scroll-target="#연속변수들-변형---답"><span class="header-section-number">1.2.7</span> 연속변수들 변형 - 답</a></li>
  <li><a href="#forest-plot" id="toc-forest-plot" class="nav-link" data-scroll-target="#forest-plot"><span class="header-section-number">1.2.8</span> forest plot</a></li>
  <li><a href="#forest-plot---답" id="toc-forest-plot---답" class="nav-link" data-scroll-target="#forest-plot---답"><span class="header-section-number">1.2.9</span> forest plot - 답</a></li>
  <li><a href="#validation" id="toc-validation" class="nav-link" data-scroll-target="#validation"><span class="header-section-number">1.2.10</span> validation</a></li>
  <li><a href="#validation---답" id="toc-validation---답" class="nav-link" data-scroll-target="#validation---답"><span class="header-section-number">1.2.11</span> validation - 답</a></li>
  <li><a href="#c-index" id="toc-c-index" class="nav-link" data-scroll-target="#c-index"><span class="header-section-number">1.2.12</span> C-index</a></li>
  <li><a href="#c-index---답" id="toc-c-index---답" class="nav-link" data-scroll-target="#c-index---답"><span class="header-section-number">1.2.13</span> C-index - 답</a></li>
  <li><a href="#nomogram" id="toc-nomogram" class="nav-link" data-scroll-target="#nomogram"><span class="header-section-number">1.2.14</span> Nomogram</a></li>
  <li><a href="#nomogram---답" id="toc-nomogram---답" class="nav-link" data-scroll-target="#nomogram---답"><span class="header-section-number">1.2.15</span> Nomogram - 답</a></li>
  <li><a href="#odds-ratio-그래프" id="toc-odds-ratio-그래프" class="nav-link" data-scroll-target="#odds-ratio-그래프"><span class="header-section-number">1.2.16</span> Odds ratio 그래프</a></li>
  <li><a href="#odds-ratio-그래프---답" id="toc-odds-ratio-그래프---답" class="nav-link" data-scroll-target="#odds-ratio-그래프---답"><span class="header-section-number">1.2.17</span> Odds ratio 그래프 - 답</a></li>
  <li><a href="#predict-그래프" id="toc-predict-그래프" class="nav-link" data-scroll-target="#predict-그래프"><span class="header-section-number">1.2.18</span> predict 그래프</a></li>
  <li><a href="#predict-그래프---답" id="toc-predict-그래프---답" class="nav-link" data-scroll-target="#predict-그래프---답"><span class="header-section-number">1.2.19</span> predict 그래프 - 답</a></li>
  <li><a href="#survival-curve" id="toc-survival-curve" class="nav-link" data-scroll-target="#survival-curve"><span class="header-section-number">1.2.20</span> survival curve</a></li>
  <li><a href="#survival-curve---답" id="toc-survival-curve---답" class="nav-link" data-scroll-target="#survival-curve---답"><span class="header-section-number">1.2.21</span> survival curve - 답</a></li>
  </ul></li>
  <li><a href="#두개의-변수들의-상관관계-살펴보기" id="toc-두개의-변수들의-상관관계-살펴보기" class="nav-link" data-scroll-target="#두개의-변수들의-상관관계-살펴보기"><span class="header-section-number">1.3</span> 두개의 변수들의 상관관계 살펴보기</a></li>
  <li><a href="#상관관계---답" id="toc-상관관계---답" class="nav-link" data-scroll-target="#상관관계---답"><span class="header-section-number">1.4</span> 상관관계 - 답</a></li>
  <li><a href="#factor-다루기" id="toc-factor-다루기" class="nav-link" data-scroll-target="#factor-다루기"><span class="header-section-number">1.5</span> Factor 다루기</a>
  <ul class="collapse">
  <li><a href="#factor-만들기" id="toc-factor-만들기" class="nav-link" data-scroll-target="#factor-만들기"><span class="header-section-number">1.5.1</span> Factor 만들기</a></li>
  <li><a href="#factor-만들기---답" id="toc-factor-만들기---답" class="nav-link" data-scroll-target="#factor-만들기---답"><span class="header-section-number">1.5.2</span> Factor 만들기 - 답</a></li>
  <li><a href="#factor-순서바꾸기" id="toc-factor-순서바꾸기" class="nav-link" data-scroll-target="#factor-순서바꾸기"><span class="header-section-number">1.5.3</span> Factor 순서바꾸기</a></li>
  <li><a href="#factor-순서바꾸기---답" id="toc-factor-순서바꾸기---답" class="nav-link" data-scroll-target="#factor-순서바꾸기---답"><span class="header-section-number">1.5.4</span> Factor 순서바꾸기 - 답</a></li>
  <li><a href="#cramers-v-분석" id="toc-cramers-v-분석" class="nav-link" data-scroll-target="#cramers-v-분석"><span class="header-section-number">1.5.5</span> Cramer’s V 분석</a></li>
  <li><a href="#cramers-v-분석---답" id="toc-cramers-v-분석---답" class="nav-link" data-scroll-target="#cramers-v-분석---답"><span class="header-section-number">1.5.6</span> Cramer’s V 분석 - 답</a></li>
  <li><a href="#ct_size와-tstage-nstage의-anova-test" id="toc-ct_size와-tstage-nstage의-anova-test" class="nav-link" data-scroll-target="#ct_size와-tstage-nstage의-anova-test"><span class="header-section-number">1.5.7</span> CT_size와 Tstage, Nstage의 ANOVA test</a></li>
  <li><a href="#ct_size와-tstage-nstage의-anova-test---답" id="toc-ct_size와-tstage-nstage의-anova-test---답" class="nav-link" data-scroll-target="#ct_size와-tstage-nstage의-anova-test---답"><span class="header-section-number">1.5.8</span> CT_size와 Tstage, Nstage의 ANOVA test - 답</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Quiz_Answer</h1>
</div>

<div>
  <div class="description">
    2024-12-26 이해원회장님의 퀴즈에 대한 답
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Benjamin </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 26, 2024</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">March 10, 2025</p>
    </div>
  </div>
    
  </div>
  


</header>


<section id="quiz-데이터-주무르기-생존분석" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Quiz 데이터 주무르기 + 생존분석</h1>
<section id="dataframe-index" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="dataframe-index"><span class="header-section-number">1.1</span> Dataframe Index</h2>
<p>하는 방법</p>
<section id="dataframe-load" class="level3" data-number="1.1.1">
<h3 data-number="1.1.1" class="anchored" data-anchor-id="dataframe-load"><span class="header-section-number">1.1.1</span> dataframe load</h3>
<p>하여 주십시오.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.1     ✔ tibble    3.2.1
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.0.4     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ tidyr::extract()   masks magrittr::extract()
✖ dplyr::filter()    masks stats::filter()
✖ dplyr::lag()       masks stats::lag()
✖ purrr::set_names() masks magrittr::set_names()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'reshape2'

The following object is masked from 'package:tidyr':

    smiths</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"S.rdata"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>df<span class="ot">&lt;-</span>S</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="개인정보제거" class="level3" data-number="1.1.2">
<h3 data-number="1.1.2" class="anchored" data-anchor-id="개인정보제거"><span class="header-section-number">1.1.2</span> 개인정보제거</h3>
<p>df에서 생존분석과 상관없는 개인정보를 제거하려고 합니다. 컬럼변수명들을 다음과 같이 출력하려면 어떻게 하면 될까요? (colnames, t 함수 참고)</p>
<pre><code>      [,1]             
 [1,] "hospital"       
 [2,] "ChartNo"        
 [3,] "Ca_Dx_date"     
 [4,] "Sex"            
 [5,] "OpDate"         
 [6,] "OpAge"          
 [7,] "Birthdate"      
 [8,] "NeoAdj"         
 [9,] "optype"         
[10,] "VATS"           
[11,] "Ctsolid_size"   
[12,] "CT_size"        
[13,] "path_size"      
[14,] "Cell_type"      
[15,] "Patho"          
[16,] "survival"       
[17,] "rec_free"       
[18,] "Recur_date"     
[19,] "recurrence"     
[20,] "Op_mortality"   
[21,] "death"          
[22,] "Death_date"     
[23,] "last_fu"        
[24,] "AJCC7"          
[25,] "Tstage"         
[26,] "Nstage"         
[27,] "Mstage"         
[28,] "Differentiation"
[29,] "Adj_RT"         
[30,] "adj_CT"         
[31,] "survival.60"    
[32,] "type"           
[33,] "stage"  </code></pre>
</section>
<section id="개인정보제거-답안" class="level3" data-number="1.1.3">
<h3 data-number="1.1.3" class="anchored" data-anchor-id="개인정보제거-답안"><span class="header-section-number">1.1.3</span> 개인정보제거 답안</h3>
<ol type="1">
<li>아래와 같이 t() 함수를 연속해서 사용</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df) <span class="sc">%&gt;%</span> t <span class="sc">%&gt;%</span> t</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      [,1]             
 [1,] "hospital"       
 [2,] "ChartNo"        
 [3,] "Ca_Dx_date"     
 [4,] "Sex"            
 [5,] "OpDate"         
 [6,] "OpAge"          
 [7,] "Birthdate"      
 [8,] "NeoAdj"         
 [9,] "optype"         
[10,] "VATS"           
[11,] "Ctsolid_size"   
[12,] "CT_size"        
[13,] "path_size"      
[14,] "Cell_type"      
[15,] "Patho"          
[16,] "survival"       
[17,] "rec_free"       
[18,] "Recur_date"     
[19,] "recurrence"     
[20,] "Op_mortality"   
[21,] "death"          
[22,] "Death_date"     
[23,] "last_fu"        
[24,] "AJCC7"          
[25,] "Tstage"         
[26,] "Nstage"         
[27,] "Mstage"         
[28,] "Differentiation"
[29,] "Adj_RT"         
[30,] "adj_CT"         
[31,] "survival.60"    
[32,] "type"           
[33,] "stage"          </code></pre>
</div>
</div>
<ul>
<li>풀이과정: t()함수는 전치(Transpose)를 수행하나 벡터가 입력되면 1xn 행렬로 변환되어 출력되므로 다시 t()함수를 사용하여 nx1 행렬로 변환하여 출력</li>
</ul>
<ol start="2" type="1">
<li>아래와 같이 dim() 함수를 사용</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>colnames_vec <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 메모리 주소 추적 시작</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># tracemem(colnames_vec)</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(colnames_vec) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">length</span>(colnames_vec), <span class="dv">1</span>)  <span class="co"># 벡터를 5행 1열의 행렬로 변환</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 메모리 주소 추적 시작</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co"># tracemem(colnames_vec)</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(colnames_vec)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      [,1]             
 [1,] "hospital"       
 [2,] "ChartNo"        
 [3,] "Ca_Dx_date"     
 [4,] "Sex"            
 [5,] "OpDate"         
 [6,] "OpAge"          
 [7,] "Birthdate"      
 [8,] "NeoAdj"         
 [9,] "optype"         
[10,] "VATS"           
[11,] "Ctsolid_size"   
[12,] "CT_size"        
[13,] "path_size"      
[14,] "Cell_type"      
[15,] "Patho"          
[16,] "survival"       
[17,] "rec_free"       
[18,] "Recur_date"     
[19,] "recurrence"     
[20,] "Op_mortality"   
[21,] "death"          
[22,] "Death_date"     
[23,] "last_fu"        
[24,] "AJCC7"          
[25,] "Tstage"         
[26,] "Nstage"         
[27,] "Mstage"         
[28,] "Differentiation"
[29,] "Adj_RT"         
[30,] "adj_CT"         
[31,] "survival.60"    
[32,] "type"           
[33,] "stage"          </code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># untracemem(colnames_vec)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>풀이과정:
<ul>
<li>dim() 함수: 객체의 차원을 조회하거나 설정하는 함수</li>
<li>벡터를 n행 1열 행렬로 변환: <code>dim(vec) &lt;- c(length(vec), 1)</code>을 사용하여 벡터의 차원을 변경</li>
<li>length() 함수: 벡터의 요소 개수를 반환하여 행 개수로 사용</li>
<li>R은 Copy-on-modify (수정 시 복사) 방식으로 동작하지만,</li>
<li>dim()은 객체의 메모리 주소를 유지한 채 차원 정보만 변경하기 때문에 불필요한 복사가 발생하지 않음 -결과적으로 실행 속도가 빠르고 메모리 사용량이 최소화됨</li>
</ul></li>
</ul>
</section>
<section id="개인정보제거2" class="level3" data-number="1.1.4">
<h3 data-number="1.1.4" class="anchored" data-anchor-id="개인정보제거2"><span class="header-section-number">1.1.4</span> 개인정보제거2</h3>
<p>df에서 다음의 컬럼들을 제거하려고 합니다. 개인정보관련 컬럼들 hospital, ChartNo, survival.60, last_fu, AJCC7 각자 편한 방법으로 제거하여 주십시오. 제거한 다음에 다음과 같은 결과를 내주십시오.</p>
<pre><code> [1] "Ca_Dx_date"      "Sex"             "OpDate"          "OpAge"          
 [5] "Birthdate"       "NeoAdj"          "optype"          "VATS"           
 [9] "Ctsolid_size"    "CT_size"         "path_size"       "Cell_type"      
[13] "Patho"           "survival"        "rec_free"        "Recur_date"     
[17] "recurrence"      "Op_mortality"    "death"           "Death_date"     
[21] "Tstage"          "Nstage"          "Mstage"          "Differentiation"
[25] "Adj_RT"          "adj_CT"          "type"            "stage"</code></pre>
</section>
<section id="개인정보제거2-답안" class="level3" data-number="1.1.5">
<h3 data-number="1.1.5" class="anchored" data-anchor-id="개인정보제거2-답안"><span class="header-section-number">1.1.5</span> 개인정보제거2 답안</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'data.table'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:reshape2':

    dcast, melt</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:lubridate':

    hour, isoweek, mday, minute, month, quarter, second, wday, week,
    yday, year</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:dplyr':

    between, first, last</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:purrr':

    transpose</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(df)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>df[, <span class="fu">c</span>(<span class="st">"hospital"</span>, <span class="st">"ChartNo"</span>, <span class="st">"survival.60"</span>, <span class="st">"last_fu"</span>, <span class="st">"AJCC7"</span>) <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Ca_Dx_date"      "Sex"             "OpDate"          "OpAge"          
 [5] "Birthdate"       "NeoAdj"          "optype"          "VATS"           
 [9] "Ctsolid_size"    "CT_size"         "path_size"       "Cell_type"      
[13] "Patho"           "survival"        "rec_free"        "Recur_date"     
[17] "recurrence"      "Op_mortality"    "death"           "Death_date"     
[21] "Tstage"          "Nstage"          "Mstage"          "Differentiation"
[25] "Adj_RT"          "adj_CT"          "type"            "stage"          </code></pre>
</div>
</div>
<ul>
<li>풀이과정:
<ul>
<li>data.table: 불필요한 복사가 적게 발생하는 패키지로 데이터프레임을 효율적으로 다룰 수 있음</li>
<li>:= 연산자: 데이터테이블의 컬럼을 추가하거나 수정할 때 사용</li>
</ul></li>
</ul>
</section>
<section id="특정컬럼제거" class="level3" data-number="1.1.6">
<h3 data-number="1.1.6" class="anchored" data-anchor-id="특정컬럼제거"><span class="header-section-number">1.1.6</span> 특정컬럼제거</h3>
<p>이번에는 다음의 컬럼들을 제거하려고 합니다. Ca_Dx_date, OpDate, Birthdate, Death_date colnames(df) 에서 date 또는 Date라는 이름을 가진 변수를 골라서 제거하는 방법으로 컬럼들을 제거하여 주십시오. (regxepr 함수 참고)</p>
<pre><code> [1] "Sex"             "OpAge"           "NeoAdj"          "optype"         
 [5] "VATS"            "Ctsolid_size"    "CT_size"         "path_size"      
 [9] "Cell_type"       "Patho"           "survival"        "rec_free"       
[13] "recurrence"      "Op_mortality"    "death"           "Tstage"         
[17] "Nstage"          "Mstage"          "Differentiation" "Adj_RT"         
[21] "adj_CT"          "type"            "stage"  </code></pre>
</section>
<section id="특정컬럼제거-답안" class="level3" data-number="1.1.7">
<h3 data-number="1.1.7" class="anchored" data-anchor-id="특정컬럼제거-답안"><span class="header-section-number">1.1.7</span> 특정컬럼제거 답안</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(df)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>cols_to_remove <span class="ot">&lt;-</span> <span class="fu">names</span>(df)[<span class="fu">grepl</span>(<span class="st">"date|Date"</span>, <span class="fu">names</span>(df))]</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>df[, (cols_to_remove) <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Sex"             "OpAge"           "NeoAdj"          "optype"         
 [5] "VATS"            "Ctsolid_size"    "CT_size"         "path_size"      
 [9] "Cell_type"       "Patho"           "survival"        "rec_free"       
[13] "recurrence"      "Op_mortality"    "death"           "Tstage"         
[17] "Nstage"          "Mstage"          "Differentiation" "Adj_RT"         
[21] "adj_CT"          "type"            "stage"          </code></pre>
</div>
</div>
</section>
</section>
<section id="생존분석" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="생존분석"><span class="header-section-number">1.2</span> 생존분석</h2>
<section id="데이터-준비" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="데이터-준비"><span class="header-section-number">1.2.1</span> 데이터 준비</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(moonBook)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(cancer)  <span class="do">## survival package내에 있는 각종 암관련 built in 데이터</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>rotterdam <span class="sc">%&gt;%</span> str</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   2982 obs. of  15 variables:
 $ pid   : int  1 2 3 4 5 6 7 8 9 10 ...
 $ year  : int  1992 1984 1983 1985 1983 1983 1993 1988 1988 1988 ...
 $ age   : int  74 79 44 70 75 52 40 53 60 52 ...
 $ meno  : int  1 1 0 1 1 0 0 1 1 0 ...
 $ size  : Factor w/ 3 levels "&lt;=20","20-50",..: 1 2 1 2 1 1 1 1 1 2 ...
 $ grade : int  3 3 2 3 3 3 2 2 2 3 ...
 $ nodes : int  0 0 0 0 0 0 0 0 0 5 ...
 $ pgr   : int  35 36 138 0 260 139 13 1 627 316 ...
 $ er    : int  291 611 0 12 409 303 4 4 151 976 ...
 $ hormon: int  0 0 0 0 0 0 0 0 0 0 ...
 $ chemo : int  0 0 0 0 0 0 0 0 0 0 ...
 $ rtime : num  1799 2828 6012 2624 4915 ...
 $ recur : int  0 0 0 0 0 0 0 0 0 0 ...
 $ dtime : num  1799 2828 6012 2624 4915 ...
 $ death : int  0 0 0 0 0 0 0 0 0 0 ...</code></pre>
</div>
</div>
</section>
<section id="psm모델-준비" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="psm모델-준비"><span class="header-section-number">1.2.2</span> psm모델 준비</h3>
<p>rotterdam 데이터를 살펴보면 age, meno, size, grade, nodes, pgr, er, hormon, chemo 등의 변수가 생존에 영향을 미칠 수 있는 변수로 추정됩니다. 이들 변수들이 생존기간 (dtime, death)에 미치는 모델을 만들어 주십시오.<br>
<strong>psm 모델을 만들기 위해서는 비모수 변수를 factor로 바꿔야 합니다</strong>.<br>
rotterdam 데이터를 rtd.df 라는 데이터 프레임으로 옮기고 자료구조를 psm 모델에 맞게 변형해 주세요.<br>
factor로 변형할 필요가 있는 변수들이 있는지 다음과 같은 방법으로 확인하면 됩니다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>rtd.df <span class="ot">&lt;-</span> rotterdam</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>hline <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">paste0</span>(<span class="fu">rep</span>(<span class="st">"-"</span>,x),<span class="at">collapse =</span> <span class="st">""</span>),<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,<span class="at">collapse =</span> <span class="st">""</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(rtd.df)) {</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(rtd.df)[i] <span class="sc">%&gt;%</span> cat</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"</span><span class="sc">\n</span><span class="st">"</span> <span class="sc">%&gt;%</span> cat</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  temp <span class="ot">&lt;-</span> rtd.df[,i]</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  temp <span class="sc">%&gt;%</span> unique <span class="sc">%&gt;%</span> length <span class="sc">%&gt;%</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>     <span class="fu">paste</span>(.,<span class="st">" cases </span><span class="sc">\n</span><span class="st">"</span>) <span class="sc">%&gt;%</span> cat  <span class="do">### unique한 값이 몇개인지</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  temp <span class="sc">%&gt;%</span> summary <span class="sc">%&gt;%</span> print          <span class="do">### 연속변수인지 요약</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">unique</span>(temp))<span class="sc">&lt;</span><span class="dv">4</span> ){    <span class="do">### unique value가 4개 미만이면 factor</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>    temp <span class="sc">%&gt;%</span> table <span class="sc">%&gt;%</span> print</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">sum</span>(<span class="fu">unique</span>(temp)<span class="sc">%in%</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>)<span class="sc">==</span><span class="dv">2</span>){   <span class="do">### unique value가 0,1 이면</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>      rtd.df[,i] <span class="ot">=</span> <span class="fu">factor</span>(temp, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"No"</span>,<span class="st">"Yes"</span>))  <span class="do">### No, Yes 로 자동변환</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>      rtd.df[,i] <span class="ot">=</span> <span class="fu">factor</span>(temp)      <span class="do">#### 0,1 이 아닌 경우에는 그냥 factor로</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hline</span>(<span class="dv">52</span>) <span class="sc">%&gt;%</span> cat</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>pid
2982  cases 
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    1.0   753.2  1504.5  1505.0  2254.8  3007.0 

----------------------------------------------------
year
16  cases 
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   1978    1986    1988    1988    1990    1993 

----------------------------------------------------
age
67  cases 
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  24.00   45.00   54.00   55.06   65.00   90.00 

----------------------------------------------------
meno
2  cases 
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   0.00    0.00    1.00    0.56    1.00    1.00 
.
   0    1 
1312 1670 

----------------------------------------------------
size
3  cases 
 &lt;=20 20-50   &gt;50 
 1387  1291   304 
.
 &lt;=20 20-50   &gt;50 
 1387  1291   304 

----------------------------------------------------
grade
2  cases 
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  2.000   2.000   3.000   2.734   3.000   3.000 
.
   2    3 
 794 2188 

----------------------------------------------------
nodes
28  cases 
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  0.000   0.000   1.000   2.712   4.000  34.000 

----------------------------------------------------
pgr
611  cases 
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    0.0     4.0    41.0   161.8   198.0  5004.0 

----------------------------------------------------
er
642  cases 
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    0.0    11.0    61.0   166.6   202.8  3275.0 

----------------------------------------------------
hormon
2  cases 
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.0000  0.0000  0.0000  0.1137  0.0000  1.0000 
.
   0    1 
2643  339 

----------------------------------------------------
chemo
2  cases 
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.0000  0.0000  0.0000  0.1945  0.0000  1.0000 
.
   0    1 
2402  580 

----------------------------------------------------
rtime
2182  cases 
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   36.0   823.5  1940.0  2097.9  3198.8  7043.0 

----------------------------------------------------
recur
2  cases 
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.0000  0.0000  1.0000  0.5091  1.0000  1.0000 
.
   0    1 
1464 1518 

----------------------------------------------------
dtime
2215  cases 
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
     36    1607    2638    2605    3555    7043 

----------------------------------------------------
death
2  cases 
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.0000  0.0000  0.0000  0.4266  1.0000  1.0000 
.
   0    1 
1710 1272 

----------------------------------------------------</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>rtd.df <span class="sc">%&gt;%</span> str</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   2982 obs. of  15 variables:
 $ pid   : int  1 2 3 4 5 6 7 8 9 10 ...
 $ year  : int  1992 1984 1983 1985 1983 1983 1993 1988 1988 1988 ...
 $ age   : int  74 79 44 70 75 52 40 53 60 52 ...
 $ meno  : Factor w/ 2 levels "No","Yes": 2 2 1 2 2 1 1 2 2 1 ...
 $ size  : Factor w/ 3 levels "&lt;=20","20-50",..: 1 2 1 2 1 1 1 1 1 2 ...
 $ grade : Factor w/ 2 levels "2","3": 2 2 1 2 2 2 1 1 1 2 ...
 $ nodes : int  0 0 0 0 0 0 0 0 0 5 ...
 $ pgr   : int  35 36 138 0 260 139 13 1 627 316 ...
 $ er    : int  291 611 0 12 409 303 4 4 151 976 ...
 $ hormon: Factor w/ 2 levels "No","Yes": 1 1 1 1 1 1 1 1 1 1 ...
 $ chemo : Factor w/ 2 levels "No","Yes": 1 1 1 1 1 1 1 1 1 1 ...
 $ rtime : num  1799 2828 6012 2624 4915 ...
 $ recur : Factor w/ 2 levels "No","Yes": 1 1 1 1 1 1 1 1 1 1 ...
 $ dtime : num  1799 2828 6012 2624 4915 ...
 $ death : Factor w/ 2 levels "No","Yes": 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
</div>
</div>
</section>
<section id="surv-객체-만들기" class="level3" data-number="1.2.3">
<h3 data-number="1.2.3" class="anchored" data-anchor-id="surv-객체-만들기"><span class="header-section-number">1.2.3</span> Surv 객체 만들기</h3>
<p>Surv 함수로 survival 객체를 만들어 rtd.S에 주세요. rtd.S의 생존곡선을 그려주세요.</p>
<pre><code>years &lt;- dtime/365.2422
units(years) &lt;- "Year"</code></pre>
<p><img src="images/clipboard-1359332256.png" class="img-fluid"></p>
<p>Surv function Surv(time, time2, event, …) time : right censored follow up time event : death =1, alive=0 -&gt; 주의 ! No=1, Yes=2 이렇게 factor로 되어 있는 경우에는 event = death 같은 방법으로 assign 하면 1=death, 2=left censored로 오인됨. 이걸 해결하려면 death==“Yes” 값으로 지정하면 됩니다. rms package 사용시에는 미리 attach를 해줘야 합니다.</p>
</section>
<section id="rtd.s-생존곡선-답안" class="level3" data-number="1.2.4">
<h3 data-number="1.2.4" class="anchored" data-anchor-id="rtd.s-생존곡선-답안"><span class="header-section-number">1.2.4</span> rtd.S 생존곡선 답안</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(rtd.df)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> dtime<span class="sc">/</span><span class="fl">365.2422</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># units(years) &lt;- "Year"</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>rtd.S <span class="ot">&lt;-</span> <span class="fu">Surv</span>(years, death<span class="sc">==</span><span class="st">"Yes"</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rtd.S)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/Surv_answer-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="psm-fit-모델-만들기" class="level3" data-number="1.2.5">
<h3 data-number="1.2.5" class="anchored" data-anchor-id="psm-fit-모델-만들기"><span class="header-section-number">1.2.5</span> psm fit 모델 만들기</h3>
<p>모델을 만들기 전에 datadist 함수와 datadist option을 지정해 주세요</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rms)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Hmisc</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'Hmisc'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:gt':

    html</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:dplyr':

    src, summarize</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    format.pval, units</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">datadist</span>(age, meno, size, grade, nodes, pgr, er, hormon, chemo)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>dd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                     age meno size grade nodes      pgr       er hormon chemo
Low:effect      45.00000 &lt;NA&gt; &lt;NA&gt;  &lt;NA&gt;     0    4.000   11.000   &lt;NA&gt;  &lt;NA&gt;
Adjust to       54.00000  Yes &lt;=20     3     1   41.000   61.000     No    No
High:effect     65.00000 &lt;NA&gt; &lt;NA&gt;  &lt;NA&gt;     4  198.000  202.750   &lt;NA&gt;  &lt;NA&gt;
Low:prediction  28.00000   No &lt;=20     2     0    0.000    0.000     No    No
High:prediction 84.00335  Yes  &gt;50     3    24 1757.064 1700.131    Yes   Yes
Low             24.00000   No &lt;=20     2     0    0.000    0.000     No    No
High            90.00000  Yes  &gt;50     3    34 5004.000 3275.000    Yes   Yes

Values:

meno : No Yes 
size : &lt;=20 20-50 &gt;50 
grade : 2 3 
hormon : No Yes 
chemo : No Yes </code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">datadist=</span><span class="st">'dd'</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">na.action=</span><span class="st">"na.delete"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>age,meno,size,grade,nodes,pgr,er,hormon,chemo 변수들을 이용한 psm model을 만들어 주세요 rtdfit.psm 이라는 변수에 모델을 넣고 anova plot을 그려 주세요</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>rtdfit.psm <span class="ot">&lt;-</span> <span class="fu">psm</span>(rtd.S<span class="sc">~</span>age<span class="sc">+</span> meno<span class="sc">+</span> size<span class="sc">+</span> grade<span class="sc">+</span> nodes<span class="sc">+</span> pgr<span class="sc">+</span> er<span class="sc">+</span> hormon<span class="sc">+</span> chemo)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>rtdfit.psm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Parametric Survival Model: Weibull Distribution

psm(formula = rtd.S ~ age + meno + size + grade + nodes + pgr + 
    er + hormon + chemo)

                  Model Likelihood      Discrimination    
                        Ratio Test             Indexes    
Obs     2982    LR chi2     545.05      R2       0.174    
Events  1272    d.f.            10    R2(10,2982)0.164    
sigma 0.7373    Pr(&gt; chi2) &lt;0.0001    R2(10,1272)0.343    
                                        Dxy      0.182    

            Coef    S.E.   Wald Z Pr(&gt;|Z|)
(Intercept)  3.7757 0.1450  26.03 &lt;0.0001 
age         -0.0108 0.0028  -3.83 0.0001  
meno=Yes    -0.0433 0.0742  -0.58 0.5596  
size=20-50  -0.3287 0.0488  -6.74 &lt;0.0001 
size=&gt;50    -0.6190 0.0680  -9.10 &lt;0.0001 
grade=3     -0.2352 0.0524  -4.49 &lt;0.0001 
nodes       -0.0548 0.0037 -14.80 &lt;0.0001 
pgr          0.0003 0.0001   3.00 0.0027  
er           0.0000 0.0001   0.53 0.5985  
hormon=Yes   0.0214 0.0651   0.33 0.7423  
chemo=Yes   -0.0361 0.0604  -0.60 0.5496  
Log(scale)  -0.3048 0.0241 -12.64 &lt;0.0001 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(rtdfit.psm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                Wald Statistics          Response: rtd.S 

 Factor     Chi-Square d.f. P     
 age         14.63      1   0.0001
 meno         0.34      1   0.5596
 size        88.56      2   &lt;.0001
 grade       20.18      1   &lt;.0001
 nodes      218.90      1   &lt;.0001
 pgr          9.00      1   0.0027
 er           0.28      1   0.5985
 hormon       0.11      1   0.7423
 chemo        0.36      1   0.5496
 TOTAL      543.96     10   &lt;.0001</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">anova</span>(rtdfit.psm))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/psm-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="연속변수들-변형" class="level3" data-number="1.2.6">
<h3 data-number="1.2.6" class="anchored" data-anchor-id="연속변수들-변형"><span class="header-section-number">1.2.6</span> 연속변수들 변형</h3>
<p>연속변수들에는 rcs(x,5) 와 같은 transform 함수를 적용하여 psm model 만들어서 rtdfit.psm2 라는 변수에 모델을 넣고 anova plot을 그려 주세요</p>
</section>
<section id="연속변수들-변형---답" class="level3" data-number="1.2.7">
<h3 data-number="1.2.7" class="anchored" data-anchor-id="연속변수들-변형---답"><span class="header-section-number">1.2.7</span> 연속변수들 변형 - 답</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>rtdfit.psm2 <span class="ot">&lt;-</span> <span class="fu">psm</span>(rtd.S <span class="sc">~</span> <span class="fu">rcs</span>(age,<span class="dv">5</span>) <span class="sc">+</span> meno <span class="sc">+</span> size <span class="sc">+</span> grade <span class="sc">+</span> <span class="fu">rcs</span>(nodes,<span class="dv">5</span>) <span class="sc">+</span> </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">rcs</span>(pgr,<span class="dv">5</span>) <span class="sc">+</span> <span class="fu">rcs</span>(er,<span class="dv">5</span>) <span class="sc">+</span> hormon <span class="sc">+</span> chemo, </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> rtd.df, <span class="at">dist =</span> <span class="st">"weibull"</span>, <span class="at">x=</span><span class="cn">TRUE</span>, <span class="at">y=</span><span class="cn">TRUE</span>)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>rtdfit.psm2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Parametric Survival Model: Weibull Distribution

psm(formula = rtd.S ~ rcs(age, 5) + meno + size + grade + rcs(nodes, 
    5) + rcs(pgr, 5) + rcs(er, 5) + hormon + chemo, data = rtd.df, 
    dist = "weibull", x = TRUE, y = TRUE)

                  Model Likelihood      Discrimination    
                        Ratio Test             Indexes    
Obs     2982    LR chi2     750.94      R2       0.232    
Events  1272    d.f.            21    R2(21,2982)0.217    
sigma 0.7196    Pr(&gt; chi2) &lt;0.0001    R2(21,1272)0.437    
                                        Dxy      0.208    

            Coef    S.E.    Wald Z Pr(&gt;|Z|)
(Intercept)  2.3372  0.3474   6.73 &lt;0.0001 
age          0.0206  0.0090   2.29 0.0218  
age'        -0.0456  0.0673  -0.68 0.4983  
age''        0.1780  0.2588   0.69 0.4916  
age'''      -0.3669  0.3118  -1.18 0.2393  
meno=Yes    -0.2077  0.0963  -2.16 0.0310  
size=20-50  -0.2086  0.0481  -4.34 &lt;0.0001 
size=&gt;50    -0.3820  0.0677  -5.64 &lt;0.0001 
grade=3     -0.2050  0.0515  -3.98 &lt;0.0001 
nodes       -0.3463  0.0650  -5.33 &lt;0.0001 
nodes'       3.0761  1.3762   2.24 0.0254  
nodes''     -4.2892  2.1209  -2.02 0.0431  
pgr         -0.0001  0.0059  -0.02 0.9866  
pgr'         8.7584 12.9376   0.68 0.4984  
pgr''       -9.7050 14.1372  -0.69 0.4924  
pgr'''       0.9907  1.2161   0.81 0.4153  
er           0.0037  0.0058   0.64 0.5247  
er'         -3.8990  7.1273  -0.55 0.5843  
er''         4.2944  7.8762   0.55 0.5856  
er'''       -0.4013  0.7705  -0.52 0.6025  
hormon=Yes   0.2051  0.0663   3.10 0.0020  
chemo=Yes    0.2256  0.0679   3.32 0.0009  
Log(scale)  -0.3291  0.0238 -13.82 &lt;0.0001 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(rtdfit.psm2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                Wald Statistics          Response: rtd.S 

 Factor          Chi-Square d.f. P     
 age              72.17      4   &lt;.0001
  Nonlinear       58.96      3   &lt;.0001
 meno              4.65      1   0.0310
 size             34.44      2   &lt;.0001
 grade            15.87      1   0.0001
 nodes           307.61      3   &lt;.0001
  Nonlinear      120.60      2   &lt;.0001
 pgr              18.97      4   0.0008
  Nonlinear       14.42      3   0.0024
 er                0.90      4   0.9246
  Nonlinear        0.89      3   0.8288
 hormon            9.58      1   0.0020
 chemo            11.05      1   0.0009
 TOTAL NONLINEAR 193.77     11   &lt;.0001
 TOTAL           661.71     21   &lt;.0001</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">anova</span>(rtdfit.psm2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/psm2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="forest-plot" class="level3" data-number="1.2.8">
<h3 data-number="1.2.8" class="anchored" data-anchor-id="forest-plot"><span class="header-section-number">1.2.8</span> forest plot</h3>
<p>위의 모델에 대한 forest plot을 그려 주세요 rms package의 psm class는 ormPlot의 forestplot 함수로만 그릴 수 있습니다.</p>
</section>
<section id="forest-plot---답" class="level3" data-number="1.2.9">
<h3 data-number="1.2.9" class="anchored" data-anchor-id="forest-plot---답"><span class="header-section-number">1.2.9</span> forest plot - 답</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ormPlot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Registered S3 method overwritten by 'ormPlot':
  method           from
  plot.summary.rms rms </code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">forestplot</span>(<span class="fu">summary</span>(rtdfit.psm2)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/forest_plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="validation" class="level3" data-number="1.2.10">
<h3 data-number="1.2.10" class="anchored" data-anchor-id="validation"><span class="header-section-number">1.2.10</span> validation</h3>
<p>validate를 해주세요 rtdfit.psm2 모델에 대해서 bootstrap method로 200번 반복하여 검증해 주세요 validate 함수 결과를 rtdfpsm.val에 넣고 결과값을 보여주세요</p>
</section>
<section id="validation---답" class="level3" data-number="1.2.11">
<h3 data-number="1.2.11" class="anchored" data-anchor-id="validation---답"><span class="header-section-number">1.2.11</span> validation - 답</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>rtdfpsm.val <span class="ot">&lt;-</span> <span class="fu">validate</span>(rtdfit.psm2, <span class="at">method =</span> <span class="st">"boot"</span>, <span class="at">B=</span><span class="dv">200</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>rtdfpsm.val</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          index.orig training    test optimism index.corrected   n
Dxy           0.4448   0.4495  0.4388   0.0106          0.4341 200
R2            0.2318   0.2397  0.2256   0.0141          0.2176 200
Intercept     0.0000   0.0000  0.0842  -0.0842          0.0842 200
Slope         1.0000   1.0000  0.9687   0.0313          0.9687 200
D             0.0778   0.0810  0.0755   0.0055          0.0723 200
U            -0.0002  -0.0002 -0.0004   0.0002         -0.0004 200
Q             0.0780   0.0812  0.0759   0.0053          0.0728 200
g             0.6233   0.6369  0.6153   0.0215          0.6017 200</code></pre>
</div>
</div>
</section>
<section id="c-index" class="level3" data-number="1.2.12">
<h3 data-number="1.2.12" class="anchored" data-anchor-id="c-index"><span class="header-section-number">1.2.12</span> C-index</h3>
<p>C-index를 구해주세요 corrected <span class="math inline">\(D_x_y\)</span> 를 이용하여 계산해 주세요</p>
</section>
<section id="c-index---답" class="level3" data-number="1.2.13">
<h3 data-number="1.2.13" class="anchored" data-anchor-id="c-index---답"><span class="header-section-number">1.2.13</span> C-index - 답</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>rtdfpsm.val[<span class="dv">1</span>,<span class="dv">5</span>]<span class="sc">/</span><span class="dv">2</span> <span class="sc">+</span><span class="fl">0.5</span>  <span class="do">## corrected index of Dxy</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.71707</code></pre>
</div>
</div>
</section>
<section id="nomogram" class="level3" data-number="1.2.14">
<h3 data-number="1.2.14" class="anchored" data-anchor-id="nomogram"><span class="header-section-number">1.2.14</span> Nomogram</h3>
<p>Nomogram 그리기 rtdfit.psm2 모델에 대해서 nomogram을 구해주세요</p>
</section>
<section id="nomogram---답" class="level3" data-number="1.2.15">
<h3 data-number="1.2.15" class="anchored" data-anchor-id="nomogram---답"><span class="header-section-number">1.2.15</span> Nomogram - 답</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nomogram</span>(rtdfit.psm2, <span class="at">fun =</span> <span class="cf">function</span>(x){<span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(<span class="sc">-</span>x))})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Points per unit of linear predictor: 81.40429 
Linear predictor units per point   : 0.01228436 


 age Points
 20  35    
 25  44    
 30  52    
 35  61    
 40  69    
 45  75    
 50  79    
 55  83    
 60  88    
 65  88    
 70  77    
 75  59    
 80  39    
 85  20    
 90   0    


 meno Points
 No   17    
 Yes   0    


 size  Points
 &lt;=20  31    
 20-50 14    
 &gt;50    0    


 grade Points
 2     17    
 3      0    


 nodes Points
  0    100   
  5     26   
 10     11   
 15      8   
 20      6   
 25      4   
 30      2   
 35      0   


 pgr  Points
    0  0    
  500 18    
 1000 20    
 1500 22    
 2000 24    
 2500 26    
 3000 28    
 3500 30    
 4000 32    
 4500 34    
 5000 36    
 5500 38    


 er   Points
    0  6    
  500 11    
 1000 10    
 1500  8    
 2000  6    
 2500  4    
 3000  2    
 3500  0    


 hormon Points
 No      0    
 Yes    17    


 chemo Points
 No     0    
 Yes   18    


 Total Points Predicted Value
           33            0.65
           51            0.70
           72            0.75
           95            0.80
          123            0.85
          161            0.90
          222            0.95</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">nomogram</span>(rtdfit.psm2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/nomogram-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="odds-ratio-그래프" class="level3" data-number="1.2.16">
<h3 data-number="1.2.16" class="anchored" data-anchor-id="odds-ratio-그래프"><span class="header-section-number">1.2.16</span> Odds ratio 그래프</h3>
<p>ggplot 함수를 이용해서 rtdfit.psm2 각 변수별 Odds ratio 그래프를 그려주세요</p>
</section>
<section id="odds-ratio-그래프---답" class="level3" data-number="1.2.17">
<h3 data-number="1.2.17" class="anchored" data-anchor-id="odds-ratio-그래프---답"><span class="header-section-number">1.2.17</span> Odds ratio 그래프 - 답</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>a<span class="ot">&lt;-</span> <span class="fu">anova</span>(rtdfit.psm2)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">Predict</span>(rtdfit.psm2, <span class="at">ref.zero =</span> T), <span class="at">vnames =</span> <span class="st">"names"</span>,</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">sepdiscrete =</span> <span class="st">"vertical"</span>, <span class="at">anova =</span> a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/sepdiscrete-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="predict-그래프" class="level3" data-number="1.2.18">
<h3 data-number="1.2.18" class="anchored" data-anchor-id="predict-그래프"><span class="header-section-number">1.2.18</span> predict 그래프</h3>
<p>rtdfit.psm2 에서 nodes에 대한 predict 그래프를 그려주세요</p>
</section>
<section id="predict-그래프---답" class="level3" data-number="1.2.19">
<h3 data-number="1.2.19" class="anchored" data-anchor-id="predict-그래프---답"><span class="header-section-number">1.2.19</span> predict 그래프 - 답</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">Predict</span>(rtdfit.psm2,nodes))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/predict-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="survival-curve" class="level3" data-number="1.2.20">
<h3 data-number="1.2.20" class="anchored" data-anchor-id="survival-curve"><span class="header-section-number">1.2.20</span> survival curve</h3>
<p>단일 변수 size에 대한 psm 모델을 만들어서 생존곡선을 그려 주세요</p>
</section>
<section id="survival-curve---답" class="level3" data-number="1.2.21">
<h3 data-number="1.2.21" class="anchored" data-anchor-id="survival-curve---답"><span class="header-section-number">1.2.21</span> survival curve - 답</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>fit.t <span class="ot">&lt;-</span> <span class="fu">psm</span>(rtd.S<span class="sc">~</span>size)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">survplot</span>(fit.t,  <span class="at">col=</span><span class="fu">rainbow</span>(<span class="dv">10</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/size-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="두개의-변수들의-상관관계-살펴보기" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="두개의-변수들의-상관관계-살펴보기"><span class="header-section-number">1.3</span> 두개의 변수들의 상관관계 살펴보기</h2>
<p>다음과 같은 crosstab table을 만들어 보세요</p>
</section>
<section id="상관관계---답" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="상관관계---답"><span class="header-section-number">1.4</span> 상관관계 - 답</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>df<span class="ot">&lt;-</span><span class="fu">as.data.table</span>(df)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="co"># reshape2::dcast(df, df$Nsatge~df$Tstage) </span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">dcast</span>(Nstage<span class="sc">~</span>Tstage)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Using 'stage' as value column. Use 'value.var' to override</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in dcast.data.table(., Nstage ~ Tstage): 'fun.aggregate' is NULL, but
found duplicate row/column combinations, so defaulting to length(). That is,
the variables [Nstage, Tstage] used in 'formula' do not uniquely identify rows
in the input 'data'. In such cases, 'fun.aggregate' is used to derive a single
representative value for each combination in the output data.table, for example
by summing or averaging (fun.aggregate=sum or fun.aggregate=mean,
respectively). Check the resulting table for values larger than 1 to see which
combinations were not unique. See ?dcast.data.table for more details.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Key: &lt;Nstage&gt;
   Nstage    1a    1b    2a    2b     3     4    is
    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
1:      0   126   110   326    87   134    36     3
2:      1    16    26   147    45    62    38     0
3:      2    21    39   169    51   106    41     0
4:      3     0     3    11     0     8     1     0</code></pre>
</div>
</div>
</section>
<section id="factor-다루기" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="factor-다루기"><span class="header-section-number">1.5</span> Factor 다루기</h2>
<section id="factor-만들기" class="level3" data-number="1.5.1">
<h3 data-number="1.5.1" class="anchored" data-anchor-id="factor-만들기"><span class="header-section-number">1.5.1</span> Factor 만들기</h3>
<p>factor 함수를 이용하여 Tstage, Nstage, Mstage를 factor 변수로 만들어 보시오. 다음과 같은 결과를 만들어주세요</p>
</section>
<section id="factor-만들기---답" class="level3" data-number="1.5.2">
<h3 data-number="1.5.2" class="anchored" data-anchor-id="factor-만들기---답"><span class="header-section-number">1.5.2</span> Factor 만들기 - 답</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>Tstage <span class="ot">&lt;-</span> <span class="fu">factor</span>(df<span class="sc">$</span>Tstage)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>Nstage <span class="ot">&lt;-</span> <span class="fu">factor</span>(df<span class="sc">$</span>Nstage)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>Mstage <span class="ot">&lt;-</span> <span class="fu">factor</span>(df<span class="sc">$</span>Mstage)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>Tstage <span class="sc">%&gt;%</span> table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>.
 1a  1b  2a  2b   3   4  is 
163 178 653 183 310 116   3 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>Nstage <span class="sc">%&gt;%</span> table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>.
  0   1   2   3 
822 334 427  23 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>Mstage <span class="sc">%&gt;%</span> table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>.
   0   1a   1b 
1553   34   19 </code></pre>
</div>
</div>
</section>
<section id="factor-순서바꾸기" class="level3" data-number="1.5.3">
<h3 data-number="1.5.3" class="anchored" data-anchor-id="factor-순서바꾸기"><span class="header-section-number">1.5.3</span> Factor 순서바꾸기</h3>
<p>위의 결과를 보면 Tstage의 level은 1a 1b 2a 2b 3 4 is의 순서입니다. 이것을 is 1a 1b 2a 2b 3 4의 순서로 바꾸시오. 다음과 같은 결과를 만들어주세요</p>
</section>
<section id="factor-순서바꾸기---답" class="level3" data-number="1.5.4">
<h3 data-number="1.5.4" class="anchored" data-anchor-id="factor-순서바꾸기---답"><span class="header-section-number">1.5.4</span> Factor 순서바꾸기 - 답</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>Tstage <span class="ot">&lt;-</span> <span class="fu">factor</span>(df<span class="sc">$</span>Tstage, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"is"</span>, <span class="st">"1a"</span>, <span class="st">"1b"</span>, <span class="st">"2a"</span>, <span class="st">"2b"</span>, <span class="st">"3"</span>, <span class="st">"4"</span>))</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>Tstage <span class="sc">%&gt;%</span> table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>.
 is  1a  1b  2a  2b   3   4 
  3 163 178 653 183 310 116 </code></pre>
</div>
</div>
</section>
<section id="cramers-v-분석" class="level3" data-number="1.5.5">
<h3 data-number="1.5.5" class="anchored" data-anchor-id="cramers-v-분석"><span class="header-section-number">1.5.5</span> Cramer’s V 분석</h3>
<p>두변수의 Cramer’s V 분석을 해주세요</p>
</section>
<section id="cramers-v-분석---답" class="level3" data-number="1.5.6">
<h3 data-number="1.5.6" class="anchored" data-anchor-id="cramers-v-분석---답"><span class="header-section-number">1.5.6</span> Cramer’s V 분석 - 답</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: grid</code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>table_data <span class="ot">&lt;-</span> <span class="fu">table</span>(df<span class="sc">$</span>Tstage, df<span class="sc">$</span>Nstage)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>cramers_v <span class="ot">&lt;-</span> <span class="fu">assocstats</span>(table_data)<span class="sc">$</span>cramer</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cramers_v)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1418604</code></pre>
</div>
</div>
</section>
<section id="ct_size와-tstage-nstage의-anova-test" class="level3" data-number="1.5.7">
<h3 data-number="1.5.7" class="anchored" data-anchor-id="ct_size와-tstage-nstage의-anova-test"><span class="header-section-number">1.5.7</span> CT_size와 Tstage, Nstage의 ANOVA test</h3>
</section>
<section id="ct_size와-tstage-nstage의-anova-test---답" class="level3" data-number="1.5.8">
<h3 data-number="1.5.8" class="anchored" data-anchor-id="ct_size와-tstage-nstage의-anova-test---답"><span class="header-section-number">1.5.8</span> CT_size와 Tstage, Nstage의 ANOVA test - 답</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(CT_size <span class="sc">~</span> Nstage, <span class="at">data=</span>df) <span class="sc">%&gt;%</span> summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              Df Sum Sq Mean Sq F value   Pr(&gt;F)    
Nstage         3    144   48.10    9.26 4.51e-06 ***
Residuals   1602   8321    5.19                     
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(CT_size <span class="sc">~</span> Tstage, <span class="at">data=</span>df, <span class="at">col=</span><span class="fu">rainbow</span>(<span class="dv">9</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/anova-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>